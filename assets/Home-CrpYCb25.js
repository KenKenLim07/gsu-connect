import{j as e}from"./ui-L36-SHUh.js";import{u as E}from"./query-D6ti8Mjz.js";import{C as M,a as _,g as F}from"./newsService-C0zSZ3O-.js";import{a as o,L}from"./vendor-BMJYCA8e.js";import{m as N}from"./animations-BCnMlSfH.js";import{b as T}from"./icons-CH71D4mC.js";import"./index-Cl2AUrdM.js";import"./utils-DARsLm--.js";import"./index-BAYP90Ju.js";function A({news:s,loading:h,error:i}){const[m,n]=o.useState(null),u=s.filter(r=>r.image_url).sort((r,a)=>new Date(a.published_at).getTime()-new Date(r.published_at).getTime()).slice(0,3),c=r=>{const a=new Date(r),t=new Date,j=Math.abs(t.getTime()-a.getTime()),y=Math.ceil(j/(1e3*60*60*24));return y===1?"Today":y===2?"Yesterday":y<=7?`${y-1} days ago`:a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:a.getFullYear()!==t.getFullYear()?"numeric":void 0})},d=(r,a)=>{r.stopPropagation(),n(m===a?null:a)},p=(r,a)=>{r.stopPropagation(),a.source_url&&window.open(a.source_url,"_blank","noopener,noreferrer"),n(null)},f=async(r,a)=>{if(r.stopPropagation(),navigator.share)try{await navigator.share({title:a.title,text:a.content.substring(0,100),url:a.source_url||window.location.href})}catch{console.log("Share cancelled or failed")}else{const t=`${a.title}

${a.content.substring(0,100)}...

Read more: ${a.source_url||window.location.href}`;try{await navigator.clipboard.writeText(t),console.log("Content copied to clipboard")}catch{console.error("Failed to copy to clipboard")}}n(null)},x=()=>{n(null)};return h&&(!s||s.length===0)?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(3)].map((r,a)=>e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:a*.1},className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"h-40 bg-gray-100 animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-100 animate-pulse rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-100 animate-pulse rounded w-1/2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-5/6"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-20"})})]})]},a))}):i?e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Failed to load news"}),e.jsx("p",{className:"text-red-500 text-sm mb-3",children:i}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-3 py-1.5 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm",children:"Try Again"})]})}):u.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsx("p",{className:"text-gray-500 font-medium",children:"No news available"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Check back later for updates"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",onClick:x,children:u.map((r,a)=>e.jsxs(N.article,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:a*.1},className:"group bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md hover:border-gray-200 transition-all duration-300",children:[e.jsxs("div",{className:"relative h-40 overflow-hidden",children:[e.jsx("img",{src:r.image_url,alt:r.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 leading-tight line-clamp-2 text-sm flex-1",children:r.title}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:t=>d(t,a),className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"})})}),m===a&&e.jsxs("div",{className:"absolute right-0 top-6 z-20 bg-white border border-gray-200 rounded-md shadow-lg min-w-[140px]",children:[e.jsxs("button",{onClick:t=>p(t,r),className:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"View Source"]}),e.jsxs("button",{onClick:t=>f(t,r),className:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors border-t border-gray-100 flex items-center gap-2",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})]}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed line-clamp-2",children:r.content.length>100?`${r.content.substring(0,100)}...`:r.content}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx("span",{className:"whitespace-nowrap",children:c(r.published_at)}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"truncate",children:r.source_url?new URL(r.source_url).hostname.replace("www.",""):"GSU"})]})]})]},r.id))})}function U({news:s,isImageLoaded:h=!1,index:i,onImageLoaded:m,canLoad:n}){const[u,c]=o.useState(!h),[d,p]=o.useState(!1),[f,x]=o.useState(!1),[r,a]=o.useState(0),[t,j]=o.useState(!1),[y,w]=o.useState(!1),k=o.useRef(null),v=o.useRef(null),C=o.useRef(null),b=o.useRef(null),S=o.useRef(null);o.useEffect(()=>{const l=g=>{S.current&&!S.current.contains(g.target)&&w(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),o.useEffect(()=>{const l=()=>{j(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),o.useEffect(()=>{n&&!d&&(p(!0),x(!0))},[n,d]),o.useEffect(()=>(v.current=new IntersectionObserver(l=>{l.forEach(g=>{g.isIntersecting&&n&&(p(!0),x(!0))})},{root:null,rootMargin:t?"300px 0px":"1500px 0px",threshold:t?.1:0}),k.current&&v.current.observe(k.current),()=>{v.current&&v.current.disconnect()}),[n,t]),o.useEffect(()=>{if(n&&!f){const l=setTimeout(()=>{f||(p(!0),x(!0))},t?100:500);return()=>clearTimeout(l)}},[n,f,t]),o.useEffect(()=>()=>{b.current&&clearTimeout(b.current)},[]);const I=()=>{r<3?(a(l=>l+1),c(!0),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{if(C.current&&s.image_url){const l=Date.now(),g=s.image_url.includes("?")?"&":"?";C.current.src=`${s.image_url}${g}t=${l}`}},Math.min(1e3*Math.pow(2,r),5e3))):(c(!1),m(i))},R=()=>{c(!1),x(!0),m(i)},z=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),$=l=>{l.stopPropagation(),w(!y)},D=l=>{l.stopPropagation(),s.source_url&&window.open(s.source_url,"_blank","noopener,noreferrer"),w(!1)},P=async l=>{if(l.stopPropagation(),navigator.share)try{await navigator.share({title:s.title,text:s.content.substring(0,100),url:s.source_url||window.location.href})}catch{console.log("Share cancelled or failed")}else{const g=`${s.title}

${s.content.substring(0,100)}...

Read more: ${s.source_url||window.location.href}`;try{await navigator.clipboard.writeText(g),console.log("Content copied to clipboard")}catch{console.error("Failed to copy to clipboard")}}w(!1)};return e.jsx("div",{className:"block relative h-full",style:{touchAction:"pan-y pinch-zoom"},children:e.jsx("div",{ref:k,className:"relative h-full overflow-hidden rounded-lg bg-white shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-[53%] h-full relative",children:[u&&e.jsx("div",{className:"w-full h-full bg-gray-100 animate-pulse"}),d&&e.jsx("img",{ref:C,src:s.image_url,alt:s.title,className:`w-full h-full object-cover ${u?"hidden":"block"}`,onLoad:R,onError:I,loading:t?"eager":"lazy",decoding:t?"async":"auto"})]}),e.jsxs("div",{className:"w-[47%] h-full flex flex-col p-3",children:[e.jsxs("div",{className:"mb-1 flex justify-between items-center relative",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 underline underline-offset-2",children:"CST"}),e.jsxs("div",{ref:S,className:"relative",children:[e.jsx("button",{onClick:$,className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"})})}),y&&e.jsxs("div",{className:"absolute right-0 top-6 z-20 bg-white border border-gray-200 rounded-md shadow-lg min-w-[140px]",children:[e.jsxs("button",{onClick:D,className:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"View Source"]}),e.jsxs("button",{onClick:P,className:"w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-50 transition-colors border-t border-gray-100 flex items-center gap-2",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})]}),e.jsxs("div",{className:"flex-1 space-y-3 min-h-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 leading-tight line-clamp-3",children:s.title}),e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed line-clamp-6",children:s.content.length>150?`${s.content.substring(0,150)}...`:s.content})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 pt-2 border-t border-gray-100 flex-shrink-0",children:[e.jsx("span",{className:"truncate",children:s.source_url?new URL(s.source_url).hostname.replace("www.",""):"GSU"}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"whitespace-nowrap",children:z(s.published_at)})]})]})]})})})}const B=async s=>{const h=new Set;return await Promise.all(s.filter(i=>i.image_url).map(async i=>{const m=i.image_url;try{const n=new Image;await new Promise((u,c)=>{n.onload=u,n.onerror=c,n.src=m}),h.add(m)}catch(n){console.warn(`Failed to preload image: ${m}`,n)}})),h};function V({news:s,loading:h,error:i}){const[m,n]=o.useState(new Set),[u,c]=o.useState(0),{data:d=new Set}=E({queryKey:["cstPreloadedImages",s.map(a=>a.id).join(",")],queryFn:()=>B(s),enabled:s.length>0,staleTime:5*60*1e3,gcTime:30*60*1e3}),p=a=>{n(t=>new Set([...t,a])),c(t=>t+1)},f=a=>a.image_url?d.has(a.image_url):!1,x=a=>Math.abs(a-u)<=3||m.has(a-1)||a<4;if(h&&(!s||s.length===0))return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((a,t)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsxs("div",{className:"w-full h-full bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"w-full h-[60%] bg-gray-100 animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-100 animate-pulse rounded w-3/4"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-16"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-5/6"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-4/6"})]})]})]})},t))});if(i)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-500",children:i})});if(!s||s.length===0)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No news available for CST"})});const r=[...s].sort((a,t)=>new Date(t.published_at).getTime()-new Date(a.published_at).getTime()).slice(0,10);return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((a,t)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsx(U,{news:a,isImageLoaded:f(a),index:t,onImageLoaded:p,canLoad:x(t)})},a.id))})}function Z(){const{data:s=[],isLoading:h,error:i}=E({queryKey:["news"],queryFn:async()=>{const{data:c,error:d}=await F();if(d)throw new Error("Failed to load news");return c},staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,retry:1}),m=s.filter(c=>{var d;return((d=c.campus)==null?void 0:d.name)==="Main Campus"}),n=s.filter(c=>{var d;return((d=c.campus)==null?void 0:d.name)==="CST"}),u=i instanceof Error?i.message:null;return e.jsxs("div",{className:"flex flex-col min-h-screen bg-white",children:[e.jsx("section",{className:"relative py-16 px-4",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight text-gray-900 mb-4",children:"What's News"}),e.jsx(N.p,{className:"text-xs text-gray-600 max-w-2xl mx-auto leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},children:"Stay connected. Stay informed"})]})})}),e.jsx("section",{className:"flex-1 overflow-y-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 border-b-2 border-black inline-block pb-1",children:"Salvador"}),e.jsx(L,{to:"/news?campus=Main%20Campus",children:e.jsx(M,{className:"hover:bg-gray-50 transition-colors border-gray-300",children:e.jsx(_,{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-black hover:text-gray-900",children:["Show all",e.jsx(T,{className:"w-3 h-3"})]})})})})]}),e.jsx(A,{news:m,loading:h,error:u})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 border-b-2 border-black inline-block pb-1",children:"Mosqueda"}),e.jsx(L,{to:"/news?campus=CST",children:e.jsx(M,{className:"hover:bg-gray-50 transition-colors border-gray-300",children:e.jsx(_,{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-black hover:text-gray-900",children:["Show all",e.jsx(T,{className:"w-3 h-3"})]})})})})]}),e.jsx(V,{news:n,loading:h,error:u})]})]})})]})}export{Z as default};
//# sourceMappingURL=Home-CrpYCb25.js.map
