import{j as e}from"./ui-L36-SHUh.js";import{u as M}from"./useQuery-CFclLMib.js";import{C as E,a as D,g as $}from"./newsService-BfgUgO7J.js";import{a as n,L as k}from"./vendor-BMJYCA8e.js";import{b as A,c as z,d as R}from"./icons-WbXoxoGO.js";import{A as P,m as j}from"./animations-DicYFbWZ.js";import"./index-D-Vk2PEg.js";import"./utils-DARsLm--.js";import"./index-DbMEnAJT.js";function _({news:t,variant:p,isImageLoaded:o=!1,showTitle:a=!0}){const[l,m]=n.useState(!o),u=()=>{m(!1)},c=()=>{switch(p){case"main":return"h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px]";case"other":return"h-[160px] sm:h-[200px] md:h-[240px] lg:h-[280px]";default:return"h-[180px]"}},h=y=>new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),g=y=>{t.source_url&&(y.preventDefault(),window.open(t.source_url,"_blank","noopener,noreferrer"))};return e.jsxs(k,{to:t.source_url?"#":`/news/${t.id}`,onClick:g,className:"block relative",children:[e.jsxs("div",{className:"relative",children:[l&&e.jsx("div",{className:`${c()} w-full bg-gray-100 animate-pulse`}),e.jsx("img",{src:t.image_url,alt:t.title,className:`${c()} w-full object-contain ${l?"hidden":"block"}`,onLoad:u})]}),a?e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm mt-1 space-y-0.5 p-1 md:p-[15px] text-center",children:[e.jsx("h3",{className:"text-[9px] sm:text-[10px] md:text-[10px] font-medium text-gray-900 line-clamp-2 px-1 w-full overflow-hidden",children:t.title}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-[6px] sm:text-[7px] md:text-[8px] text-gray-500 px-1 w-full",children:[e.jsx("span",{className:"truncate max-w-[60px] md:max-w-[70px]",children:t.source_url?new URL(t.source_url).hostname.replace("www.",""):"GSU"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:h(t.published_at)})]})]}):e.jsx("div",{className:"h-[70px] sm:h-[80px]"})]})}const F=async t=>{const p={};return await Promise.all(t.map(async o=>{if(o.image_url)try{const a=new Image;await new Promise((m,u)=>{a.onload=m,a.onerror=u,a.src=o.image_url});const l=a.width/a.height;p[o.id]={width:a.width,height:a.height,isValid:l>=1&&l<=16/9,isLoading:!1}}catch(a){console.warn(`Failed to load image for news item ${o.id}:`,a),p[o.id]={width:0,height:0,isValid:!1,isLoading:!1}}})),p};function U({news:t,loading:p,error:o}){const[a,l]=n.useState(0),[m,u]=n.useState(0),[c,h]=n.useState(null),[g,y]=n.useState(null),w=n.useRef(void 0),{data:T={}}=M({queryKey:["mainCampusImageDimensions",t.map(i=>i.id).join(",")],queryFn:()=>F(t),enabled:t.length>0,staleTime:5*60*1e3,gcTime:30*60*1e3}),f=50,d=n.useMemo(()=>t.filter(i=>{const s=T[i.id];return i.image_url&&(s==null?void 0:s.isValid)&&!s.isLoading}).sort((i,s)=>new Date(s.created_at).getTime()-new Date(i.created_at).getTime()).slice(0,5),[t,T]),v=n.useCallback(()=>{w.current&&clearInterval(w.current),w.current=setInterval(()=>{u(1),l(i=>(i+1)%d.length)},3300)},[d.length]);n.useEffect(()=>(d.length>0&&v(),()=>{w.current&&clearInterval(w.current)}),[d.length,v]);const r=i=>{y(null),h(i.targetTouches[0].clientX),v()},x=i=>{const s=i.targetTouches[0].clientX,b=i.targetTouches[0].clientY;if(c&&Math.abs(s-c)>Math.abs(b-(c?i.targetTouches[0].clientY:0))&&i.preventDefault(),y(s),c){const I=c-s;Math.abs(I)>f&&u(I>0?1:-1)}},N=()=>{if(!c||!g)return;const i=c-g,s=i>f,b=i<-f;Math.abs(i)>f&&(s&&l(I=>(I+1)%d.length),b&&l(I=>(I-1+d.length)%d.length)),v()},C=()=>{u(-1),l(i=>(i-1+d.length)%d.length),v()},L=()=>{u(1),l(i=>(i+1)%d.length),v()};if(p&&(!t||t.length===0))return e.jsxs("div",{className:"relative min-h-[425px]",children:[e.jsxs("div",{className:"relative flex items-center justify-center gap-0 px-4 md:px-12 overflow-visible",children:[e.jsx("div",{className:"w-1/4 md:w-1/5 -mr-4 md:-mr-6",children:e.jsx("div",{className:"w-full h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px] bg-gray-100 animate-pulse rounded-lg"})}),e.jsxs("div",{className:"w-2/3 md:w-3/4",children:[e.jsx("div",{className:"w-full h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px] bg-gray-100 animate-pulse rounded-lg"}),e.jsxs("div",{className:"mt-2 space-y-1.5 p-1.5",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-3/4 mx-auto"}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("div",{className:"h-2.5 bg-gray-100 animate-pulse rounded w-16"}),e.jsx("div",{className:"h-2.5 bg-gray-100 animate-pulse rounded w-2"}),e.jsx("div",{className:"h-2.5 bg-gray-100 animate-pulse rounded w-20"})]})]})]}),e.jsx("div",{className:"w-1/4 md:w-1/5 -ml-4 md:-ml-6",children:e.jsx("div",{className:"w-full h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px] bg-gray-100 animate-pulse rounded-lg"})})]}),e.jsx("div",{className:"mt-4 text-center",children:[1,2,3,4,5].map((i,s)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-200 inline-block mx-1"},s))})]});if(o)return e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-red-600 mb-4",children:o}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"})]});if(d.length===0)return e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-gray-500",children:"No news available for Main Campus"})});const S=i=>(a+i+d.length)%d.length;return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative group",onTouchStart:r,onTouchMove:x,onTouchEnd:N,style:{touchAction:"pan-y pinch-zoom"},children:[e.jsx("button",{onClick:C,className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 backdrop-blur-sm shadow-lg hidden md:block opacity-0 md:group-hover:opacity-100 transition-opacity duration-200 hover:bg-white","aria-label":"Previous slide",children:e.jsx(A,{className:"w-6 h-6 text-gray-600"})}),e.jsx("button",{onClick:L,className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 backdrop-blur-sm shadow-lg hidden md:block opacity-0 md:group-hover:opacity-100 transition-opacity duration-200 hover:bg-white","aria-label":"Next slide",children:e.jsx(z,{className:"w-6 h-6 text-gray-600"})}),e.jsx("div",{className:"relative flex items-center justify-center gap-0 px-4 md:px-12 overflow-visible",children:e.jsxs(P,{mode:"popLayout",initial:!1,children:[e.jsx(j.div,{initial:{x:100,opacity:0,scale:.8,zIndex:1},animate:{x:0,opacity:.7,scale:1.5,zIndex:1,y:40,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},exit:{x:-100,opacity:0,scale:.8,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},className:"w-1/4 md:w-1/5 -mr-4 md:-mr-6",children:e.jsx(_,{news:d[S(-1)],variant:"main",showTitle:!1})},`prev-${a}`),e.jsx(j.div,{initial:{x:m*100,opacity:0,scale:.9,zIndex:2},animate:{x:0,opacity:1,scale:1.4,zIndex:2,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},exit:{x:-m*100,opacity:0,scale:.9,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},className:"w-2/3 md:w-3/4",children:e.jsx(_,{news:d[a],variant:"main",showTitle:!0})},`current-${a}`),e.jsx(j.div,{initial:{x:-100,opacity:0,scale:.8,zIndex:1},animate:{x:0,opacity:.7,scale:1.5,zIndex:1,y:40,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},exit:{x:100,opacity:0,scale:.8,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},className:"w-1/4 md:w-1/5 -ml-4 md:-ml-6",children:e.jsx(_,{news:d[S(1)],variant:"main",showTitle:!1})},`next-${a}`)]})}),d.length>0&&e.jsx("div",{className:"mt-4 text-center",children:d.map((i,s)=>e.jsxs(j.button,{onClick:()=>{u(s>a?1:-1),l(s),v()},className:"relative inline-block mx-1",whileHover:{scale:1.2},whileTap:{scale:.9},children:[e.jsx(j.div,{className:`w-1.5 h-1.5 rounded-full ${s===a?"bg-blue-600":"bg-gray-300"}`,animate:{scale:s===a?[1,1.8,1.4]:1,opacity:s===a?1:.5},transition:{duration:.4,ease:"easeInOut",times:[0,.5,1]}}),s===a&&e.jsx(j.div,{className:"absolute inset-0 rounded-full bg-blue-600/20",layoutId:"activeDot",transition:{type:"spring",stiffness:500,damping:30}})]},s))})]})})}function q({news:t,isImageLoaded:p=!1,index:o,onImageLoaded:a,canLoad:l}){const[m,u]=n.useState(!p),[c,h]=n.useState(!1),[g,y]=n.useState(!1),[w,T]=n.useState(0),[f,d]=n.useState(!1),v=n.useRef(null),r=n.useRef(null),x=n.useRef(null),N=n.useRef(null);n.useEffect(()=>{const s=()=>{d(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),n.useEffect(()=>{l&&!c&&(h(!0),y(!0))},[l,c]),n.useEffect(()=>(r.current=new IntersectionObserver(s=>{s.forEach(b=>{b.isIntersecting&&l&&(h(!0),y(!0))})},{root:null,rootMargin:f?"300px 0px":"1500px 0px",threshold:f?.1:0}),v.current&&r.current.observe(v.current),()=>{r.current&&r.current.disconnect()}),[l,f]),n.useEffect(()=>{if(l&&!g){const s=setTimeout(()=>{g||(h(!0),y(!0))},f?100:500);return()=>clearTimeout(s)}},[l,g,f]),n.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]);const C=()=>{w<3?(T(s=>s+1),u(!0),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{if(x.current&&t.image_url){const s=Date.now(),b=t.image_url.includes("?")?"&":"?";x.current.src=`${t.image_url}${b}t=${s}`}},Math.min(1e3*Math.pow(2,w),5e3))):(u(!1),a(o))},L=()=>{u(!1),y(!0),a(o)},S=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),i=()=>{t.source_url&&window.open(t.source_url,"_blank","noopener,noreferrer")};return e.jsx("div",{onClick:i,className:"block relative h-full cursor-pointer hover:opacity-90 transition-opacity",style:{touchAction:"pan-y pinch-zoom"},children:e.jsxs("div",{ref:v,className:"relative h-full overflow-hidden rounded-lg",children:[m&&e.jsx("div",{className:"h-full w-full bg-gray-100 animate-pulse"}),c&&e.jsx("img",{ref:x,src:t.image_url,alt:t.title,className:`h-[239%] w-full object-cover object-top ${m?"hidden":"block"}`,onLoad:L,onError:C,loading:f?"eager":"lazy",decoding:f?"async":"auto"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm mt-1 space-y-1 p-1 text-center",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2",children:t.title}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] text-gray-500",children:[e.jsx("span",{children:t.source_url?new URL(t.source_url).hostname.replace("www.",""):"GSU"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:S(t.published_at)})]})]})]})})}const V=async(t,p)=>{const o=new Set;return await Promise.all(t.filter(a=>a.image_url).map(async a=>{const l=a.image_url;try{const m=new Image;await new Promise((u,c)=>{m.onload=u,m.onerror=c,m.src=p?`${l}?t=${Date.now()}`:l}),o.add(l)}catch(m){console.warn(`Failed to preload image: ${l}`,m)}})),o};function O({news:t,loading:p,error:o}){const[a,l]=n.useState(new Set),[m,u]=n.useState(0),[c,h]=n.useState(!1),[g,y]=n.useState(!1);n.useEffect(()=>{const r=()=>{y(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const{data:w=new Set}=M({queryKey:["cstPreloadedImages",t.map(r=>r.id).join(","),g],queryFn:()=>V(t,g),enabled:t.length>0,staleTime:5*60*1e3,gcTime:30*60*1e3});n.useEffect(()=>{if(t&&t.length>0){const r=setTimeout(()=>{h(!0)},g?500:1e3);return()=>clearTimeout(r)}},[t,g]);const T=r=>{l(x=>new Set([...x,r])),u(x=>x+1)},f=r=>r.image_url?w.has(r.image_url):!1,d=r=>c?!0:g?Math.abs(r-m)<=6||a.has(r-1)||r<8:Math.abs(r-m)<=3||a.has(r-1)||r<4;if(p&&t.length===0)return e.jsx("div",{className:"px-4 py-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((r,x)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsxs("div",{className:"w-full h-full bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"w-full h-[60%] bg-gray-100 animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-100 animate-pulse rounded w-3/4"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-16"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-5/6"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-4/6"})]})]})]})},x))})});if(o)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-500",children:o})});if(!t||t.length===0)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No news available for CST"})});const v=[...t].sort((r,x)=>new Date(x.published_at).getTime()-new Date(r.published_at).getTime()).slice(0,10);return e.jsx("div",{className:"px-4 py-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map((r,x)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsx(q,{news:r,isImageLoaded:f(r),index:x,onImageLoaded:T,canLoad:d(x)})},r.id))})})}function Z(){const{data:t=[],isLoading:p,error:o}=M({queryKey:["news"],queryFn:async()=>{const{data:c,error:h}=await $();if(h)throw new Error("Failed to load news");return c},staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),a=t.filter(c=>{var h;return((h=c.campus)==null?void 0:h.name)==="Main Campus"}),l=t.filter(c=>{var h;return((h=c.campus)==null?void 0:h.name)==="CST"}),m=o instanceof Error?o.message:null,u=p&&t.length===0;return e.jsxs("div",{className:"flex flex-col min-h-screen bg-white",children:[e.jsx("section",{className:"relative py-16 px-4",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight text-gray-900 mb-4",children:"What's News"}),e.jsx(j.p,{className:"text-gray-600 text-base md:text-lg max-w-2xl mx-auto leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},children:"Stay informed with the latest updates, events, and announcements from across our campuses"})]})})}),e.jsx("section",{className:"flex-1 overflow-y-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-medium text-gray-700",children:"Main Campus News"}),e.jsx(k,{to:"/news?campus=Main%20Campus",children:e.jsx(E,{className:"hover:bg-gray-50 transition-colors border-gray-300",children:e.jsx(D,{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-900",children:["Show all",e.jsx(R,{className:"w-3 h-3"})]})})})})]}),e.jsx(U,{news:a,loading:u,error:m})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-medium text-gray-700",children:"College of Science and Technology"}),e.jsx(k,{to:"/news?campus=CST",children:e.jsx(E,{className:"hover:bg-gray-50 transition-colors border-gray-300",children:e.jsx(D,{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-900",children:["Show all",e.jsx(R,{className:"w-3 h-3"})]})})})})]}),e.jsx(O,{news:l,loading:u,error:m})]})]})})]})}export{Z as default};
