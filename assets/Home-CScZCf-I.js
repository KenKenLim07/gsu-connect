import{j as e}from"./ui-L36-SHUh.js";import{u as E}from"./query-D6ti8Mjz.js";import{C as _,a as L,F as A,g as F}from"./newsService-BF6zMYuH.js";import{a as o,L as M}from"./vendor-BMJYCA8e.js";import{m as b,u as V}from"./animations-rsQTsJrn.js";import{b as T}from"./icons-CH71D4mC.js";import"./index-8WoioSdu.js";import"./utils-DARsLm--.js";import"./index-BAYP90Ju.js";function B({news:r,loading:u,error:i}){const[d,n]=o.useState(null),m=r.filter(t=>t.image_url).sort((t,a)=>new Date(a.published_at).getTime()-new Date(t.published_at).getTime()).slice(0,3),x=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),p=(t,a)=>{t.stopPropagation(),n(d===a?null:a)},h=(t,a)=>{t.stopPropagation(),a.source_url&&window.open(a.source_url,"_blank","noopener,noreferrer"),n(null)},c=async(t,a)=>{if(t.stopPropagation(),navigator.share)try{await navigator.share({title:a.title,text:a.content.substring(0,100),url:a.source_url||window.location.href})}catch{console.log("Share cancelled or failed")}else{const s=`${a.title}

${a.content.substring(0,100)}...

Read more: ${a.source_url||window.location.href}`;try{await navigator.clipboard.writeText(s),console.log("Content copied to clipboard")}catch{console.error("Failed to copy to clipboard")}}n(null)},g=()=>{n(null)};return u&&(!r||r.length===0)?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(3)].map((t,a)=>e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:a*.1},className:"bg-white dark:bg-gray-900 rounded-xl shadow-sm border border-gray-100 dark:border-gray-800 overflow-hidden",children:[e.jsx("div",{className:"h-40 bg-gray-100 dark:bg-gray-800 animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-1/2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-5/6"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"h-3 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-20"})})]})]},a))}):i?e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg p-4 max-w-md mx-auto",children:[e.jsx("p",{className:"text-red-600 dark:text-red-200 font-medium mb-2",children:"Failed to load news"}),e.jsx("p",{className:"text-red-500 dark:text-red-300 text-sm mb-3",children:i}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-3 py-1.5 bg-red-600 dark:bg-red-700 text-white rounded-md hover:bg-red-700 dark:hover:bg-red-800 transition-colors text-sm",children:"Try Again"})]})}):m.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4 max-w-md mx-auto",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-300 font-medium",children:"No news available"}),e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-sm mt-1",children:"Check back later for updates"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",onClick:g,children:m.map((t,a)=>e.jsxs("article",{className:"group bg-white dark:bg-gray-900 rounded-xl shadow-sm border border-gray-100 dark:border-gray-800 hover:shadow-md hover:border-gray-200 dark:hover:border-gray-700 transition-all duration-300",children:[e.jsxs("div",{className:"relative h-40 overflow-hidden",children:[e.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"})]}),e.jsxs("div",{className:"p-2 space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 leading-tight line-clamp-2 text-sm flex-1",children:t.title}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:s=>p(s,a),className:"text-gray-400 dark:text-gray-300 hover:text-gray-600 dark:hover:text-gray-100 transition-colors p-2",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"})})}),d===a&&e.jsxs("div",{className:"absolute right-0 top-6 z-20 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg min-w-[140px]",children:[e.jsxs("button",{onClick:s=>h(s,t),className:"w-full text-left px-3 py-2 text-xs text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"View Source"]}),e.jsxs("button",{onClick:s=>c(s,t),className:"w-full text-left px-3 py-2 text-xs text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors border-t border-gray-100 dark:border-gray-800 flex items-center gap-2",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{children:"gsu.edu.ph"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:x(t.published_at)})]}),t.source_url&&e.jsxs("a",{href:t.source_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-2 py-1 rounded-md border border-transparent text-xs font-medium text-gray-600 dark:text-gray-300 underline decoration-black/70 dark:decoration-white/70 underline-offset-2 hover:decoration-2 transition-colors",children:["Read full article",e.jsx("svg",{className:"w-3 h-3 ml-1",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 8l4 4m0 0l-4 4m4-4H3"})})]})]})]})]},t.id))})}function q({news:r,isImageLoaded:u=!1,index:i,onImageLoaded:d,canLoad:n}){const[m,x]=o.useState(!u),[p,h]=o.useState(!1),[c,g]=o.useState(!1),[t,a]=o.useState(0),[s,S]=o.useState(!1),[C,v]=o.useState(!1),j=o.useRef(null),w=o.useRef(null),k=o.useRef(null),f=o.useRef(null),N=o.useRef(null);o.useEffect(()=>{const l=y=>{N.current&&!N.current.contains(y.target)&&v(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),o.useEffect(()=>{const l=()=>{S(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),o.useEffect(()=>{n&&!p&&(h(!0),g(!0))},[n,p]),o.useEffect(()=>(w.current=new IntersectionObserver(l=>{l.forEach(y=>{y.isIntersecting&&n&&(h(!0),g(!0))})},{root:null,rootMargin:s?"300px 0px":"1500px 0px",threshold:s?.1:0}),j.current&&w.current.observe(j.current),()=>{w.current&&w.current.disconnect()}),[n,s]),o.useEffect(()=>{if(n&&!c){const l=setTimeout(()=>{c||(h(!0),g(!0))},s?100:500);return()=>clearTimeout(l)}},[n,c,s]),o.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const I=()=>{t<3?(a(l=>l+1),x(!0),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{if(k.current&&r.image_url){const l=Date.now(),y=r.image_url.includes("?")?"&":"?";k.current.src=`${r.image_url}${y}t=${l}`}},Math.min(1e3*Math.pow(2,t),5e3))):(x(!1),d(i))},z=()=>{x(!1),g(!0),d(i)},P=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),$=l=>{l.stopPropagation(),v(!C)},D=l=>{l.stopPropagation(),r.source_url&&window.open(r.source_url,"_blank","noopener,noreferrer"),v(!1)},W=async l=>{if(l.stopPropagation(),navigator.share)try{await navigator.share({title:r.title,text:r.content.substring(0,100),url:r.source_url||window.location.href})}catch{console.log("Share cancelled or failed")}else{const y=`${r.title}

${r.content.substring(0,100)}...

Read more: ${r.source_url||window.location.href}`;try{await navigator.clipboard.writeText(y),console.log("Content copied to clipboard")}catch{console.error("Failed to copy to clipboard")}}v(!1)};return e.jsx("div",{className:"block relative h-full",style:{touchAction:"pan-y pinch-zoom"},children:e.jsx("div",{ref:j,className:"relative h-full overflow-hidden rounded-lg bg-white dark:bg-gray-900 shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-[53%] h-full relative",children:[m&&e.jsx("div",{className:"w-full h-full bg-gray-100 dark:bg-gray-800 animate-pulse"}),p&&e.jsx("img",{ref:k,src:r.image_url,alt:r.title,className:`w-full h-full object-cover ${m?"hidden":"block"}`,onLoad:z,onError:I,loading:s?"eager":"lazy",decoding:s?"async":"auto"})]}),e.jsxs("div",{className:"w-[47%] h-full flex flex-col p-3",children:[e.jsxs("div",{className:"mb-1 flex justify-between items-center relative",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-300 underline underline-offset-2",children:"CST"}),e.jsxs("div",{ref:N,className:"relative",children:[e.jsx("button",{onClick:$,className:"text-gray-400 dark:text-gray-300 hover:text-gray-600 dark:hover:text-gray-100 transition-colors p-2",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"})})}),C&&e.jsxs("div",{className:"absolute right-0 top-6 z-20 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg min-w-[140px]",children:[e.jsxs("button",{onClick:D,className:"w-full text-left px-3 py-2 text-xs text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"View Source"]}),e.jsxs("button",{onClick:W,className:"w-full text-left px-3 py-2 text-xs text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors border-t border-gray-100 dark:border-gray-800 flex items-center gap-2",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"Share"]})]})]})]}),e.jsxs("div",{className:"flex-1 space-y-3 min-h-0",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-900 dark:text-gray-100 leading-tight line-clamp-3 underline decoration-gray-400 dark:decoration-gray-500 underline-offset-2 cursor-pointer hover:decoration-2 transition",onClick:()=>{r.source_url&&window.open(r.source_url,"_blank","noopener,noreferrer")},tabIndex:0,role:"link","aria-label":"Read full article",children:r.title}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 leading-relaxed line-clamp-6 lg:line-clamp-6",children:r.content.length>150?`${r.content.substring(0,150)}...`:r.content})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500 dark:text-gray-400 pt-2 border-t border-gray-100 dark:border-gray-800 flex-shrink-0",children:[e.jsx("span",{className:"truncate",children:r.source_url?new URL(r.source_url).hostname.replace("www.",""):"GSU"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"whitespace-nowrap",children:P(r.published_at)})]})]})]})})})}const H=async r=>{const u=new Set;return await Promise.all(r.filter(i=>i.image_url).map(async i=>{const d=i.image_url;try{const n=new Image;await new Promise((m,x)=>{n.onload=m,n.onerror=x,n.src=d}),u.add(d)}catch(n){console.warn(`Failed to preload image: ${d}`,n)}})),u};function O({news:r,loading:u,error:i}){const[d,n]=o.useState(new Set),[m,x]=o.useState(0),{data:p=new Set}=E({queryKey:["cstPreloadedImages",r.map(a=>a.id).join(",")],queryFn:()=>H(r),enabled:r.length>0,staleTime:5*60*1e3,gcTime:30*60*1e3}),h=a=>{n(s=>new Set([...s,a])),x(s=>s+1)},c=a=>a.image_url?p.has(a.image_url):!1,g=a=>Math.abs(a-m)<=3||d.has(a-1)||a<4;if(u&&(!r||r.length===0))return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((a,s)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsxs("div",{className:"w-full h-full bg-white dark:bg-gray-900 rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"w-full h-[60%] bg-gray-100 dark:bg-gray-800 animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-3/4"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-16"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-5/6"}),e.jsx("div",{className:"h-3 bg-gray-100 dark:bg-gray-800 animate-pulse rounded w-4/6"})]})]})]})},s))});if(i)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-500 dark:text-red-300",children:i})});if(!r||r.length===0)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-300",children:"No news available for CST"})});const t=[...r].sort((a,s)=>new Date(s.published_at).getTime()-new Date(a.published_at).getTime()).slice(0,10);return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((a,s)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsx(q,{news:a,isImageLoaded:c(a),index:s,onImageLoaded:h,canLoad:g(s)})},a.id))})}function R({children:r,revealOnScroll:u=!1}){const i=o.useRef(null),[d,n]=o.useState(0);o.useEffect(()=>{i.current&&n(i.current.offsetWidth)},[r]);const m=o.useRef(null),x=V(m,{once:!0,margin:"0px 0px -20% 0px"}),p=u?{initial:{opacity:0},animate:x?{opacity:1}:{opacity:0},transition:{duration:1}}:{initial:{opacity:0},animate:{opacity:1},transition:{duration:1,delay:.1}},h=u?{initial:{opacity:0,width:24},animate:x?{opacity:1,width:d||64}:{opacity:0,width:24},transition:{duration:1,delay:.15}}:{initial:{opacity:0,width:24},animate:{opacity:1,width:d||64},transition:{duration:1,delay:.25}};return e.jsxs("div",{className:"relative inline-block",ref:u?m:void 0,children:[e.jsx(b.h2,{ref:i,className:"text-lg font-bold text-gray-900 dark:text-gray-100 inline-block pb-1",...p,children:r}),e.jsx(b.span,{className:"block absolute left-0 -bottom-0.5 h-0.5 bg-black dark:bg-gray-200 rounded-full",...h,"aria-hidden":"true",style:{maxWidth:"100%"}})]})}function ae(){const{data:r=[],isLoading:u,error:i}=E({queryKey:["news"],queryFn:async()=>{const{data:c,error:g}=await F();if(g)throw new Error("Failed to load news");return c},staleTime:36e5,gcTime:72e5,refetchOnWindowFocus:!1,retry:1}),[d,n]=o.useState(!1);o.useEffect(()=>{const c=()=>{n(window.scrollY>200)};return window.addEventListener("scroll",c),()=>window.removeEventListener("scroll",c)},[]);const m=()=>{window.scrollTo({top:0,behavior:"smooth"})},x=r.filter(c=>{var g;return((g=c.campus)==null?void 0:g.name)==="Main Campus"}),p=r.filter(c=>{var g;return((g=c.campus)==null?void 0:g.name)==="CST"}),h=i instanceof Error?i.message:null;return e.jsxs("div",{className:"flex flex-col min-h-screen bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100",children:[e.jsx("section",{className:"relative py-16 px-4",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b.h1,{className:"text-4xl md:text-5xl font-bold tracking-tight text-gray-900 dark:text-gray-100 mb-4",initial:{opacity:0,y:32},animate:{opacity:1,y:0},transition:{duration:.7,delay:.1,ease:"easeOut"},children:"What's News"}),e.jsx(b.p,{className:"text-xs text-gray-600 dark:text-gray-300 max-w-2xl mx-auto leading-relaxed",initial:{opacity:0,y:32},animate:{opacity:1,y:0},transition:{duration:.7,delay:.4,ease:"easeOut"},children:"Stay connected. Stay informed"})]})})}),e.jsx("section",{className:"flex-1 overflow-y-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{children:"Salvador"}),e.jsx(M,{to:"/news?campus=Main%20Campus",children:e.jsx(_,{className:"hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors border-gray-300 dark:border-gray-700",children:e.jsx(L,{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-black dark:text-gray-100 hover:text-gray-900 dark:hover:text-white",children:["Show all",e.jsx(T,{className:"w-3 h-3"})]})})})})]}),e.jsx(B,{news:x,loading:u,error:h})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-700 to-transparent"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{revealOnScroll:!0,children:"Mosqueda"}),e.jsx(M,{to:"/news?campus=CST",children:e.jsx(_,{className:"hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors border-gray-300 dark:border-gray-700",children:e.jsx(L,{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-black dark:text-gray-100 hover:text-gray-900 dark:hover:text-white",children:["Show all",e.jsx(T,{className:"w-3 h-3"})]})})})})]}),e.jsx(O,{news:p,loading:u,error:h})]})]})}),d&&e.jsx("button",{onClick:m,className:"fixed bottom-6 right-6 z-50 p-3 rounded-full bg-gray-900 text-white dark:bg-gray-100 dark:text-gray-900 shadow-lg hover:bg-gray-700 dark:hover:bg-gray-200 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary","aria-label":"Scroll to top",children:e.jsx(A,{className:"w-5 h-5"})})]})}export{ae as default};
//# sourceMappingURL=Home-CScZCf-I.js.map
