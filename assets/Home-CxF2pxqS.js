import{j as e}from"./ui-L36-SHUh.js";import{u as D}from"./query-D6ti8Mjz.js";import{C as E,a as $,g as A}from"./newsService-BG55eRvg.js";import{a as r,L as R}from"./vendor-BMJYCA8e.js";import{b as P,c as F,d as z}from"./icons-WbXoxoGO.js";import{A as U,m as b}from"./animations-DicYFbWZ.js";import"./index--RPJYuKb.js";import"./utils-DARsLm--.js";import"./index-BAYP90Ju.js";function k({news:s,variant:g,isImageLoaded:n=!1,showTitle:a=!0}){const[t,h]=r.useState(!n),o=()=>{h(!1)},l=()=>{switch(g){case"main":return"h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px]";case"other":return"h-[160px] sm:h-[200px] md:h-[240px] lg:h-[280px]";default:return"h-[180px]"}},N=p=>new Date(p).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),w=p=>{s.source_url&&(p.preventDefault(),window.open(s.source_url,"_blank","noopener,noreferrer"))};return e.jsxs(R,{to:s.source_url?"#":`/news/${s.id}`,onClick:w,className:"block relative",children:[e.jsxs("div",{className:"relative",children:[t&&e.jsx("div",{className:`${l()} w-full bg-gray-100 animate-pulse`}),e.jsx("img",{src:s.image_url,alt:s.title,className:`${l()} w-full object-contain ${t?"hidden":"block"}`,onLoad:o})]}),a?e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm mt-1 space-y-0.5 p-1 md:p-[15px] text-center",children:[e.jsx("h3",{className:"text-[9px] sm:text-[10px] md:text-[10px] font-medium text-gray-900 line-clamp-2 px-1 w-full overflow-hidden",children:s.title}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-[6px] sm:text-[7px] md:text-[8px] text-gray-500 px-1 w-full",children:[e.jsx("span",{className:"truncate max-w-[60px] md:max-w-[70px]",children:s.source_url?new URL(s.source_url).hostname.replace("www.",""):"GSU"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:N(s.published_at)})]})]}):e.jsx("div",{className:"h-[70px] sm:h-[80px]"})]})}const q=async s=>{console.log("[MainCampusNews] Starting image preload for",s.length,"items");const g={};return await Promise.all(s.map(async n=>{if(!n.image_url){console.log("[MainCampusNews] No image URL for item:",n.id);return}try{const a=new Image;await new Promise((h,o)=>{a.onload=()=>{console.log("[MainCampusNews] Image loaded successfully:",n.id),h(null)},a.onerror=l=>{console.warn("[MainCampusNews] Failed to load image:",n.id,l),o(l)},a.src=n.image_url});const t=a.width/a.height;g[n.id]={width:a.width,height:a.height,isValid:t>=1&&t<=16/9,isLoading:!1}}catch(a){console.warn(`[MainCampusNews] Failed to load image for news item ${n.id}:`,a),g[n.id]={width:0,height:0,isValid:!1,isLoading:!1}}})),console.log("[MainCampusNews] Image preload complete:",g),g};function V({news:s,loading:g,error:n}){console.log("[MainCampusNews] Component render:",{newsLength:s.length,parentLoading:g,error:n});const[a,t]=r.useState(0),[h,o]=r.useState(0),[l,N]=r.useState(null),[w,p]=r.useState(null),v=r.useRef(void 0),d=r.useRef(!1),{data:m={},isLoading:S}=D({queryKey:["mainCampusImageDimensions",s.map(i=>i.id).join(",")],queryFn:()=>q(s),enabled:s.length>0,staleTime:5*60*1e3,gcTime:30*60*1e3});r.useEffect(()=>(d.current=!0,console.log("[MainCampusNews] Component mounted"),()=>{d.current=!1,console.log("[MainCampusNews] Component unmounted")}),[]);const j=50,c=r.useMemo(()=>{console.log("[MainCampusNews] Filtering news:",{totalNews:s.length,imageDimensionsCount:Object.keys(m).length});const i=s.filter(u=>{const f=m[u.id],I=u.image_url&&(f==null?void 0:f.isValid)&&!f.isLoading;return I||console.log("[MainCampusNews] Item filtered out:",u.id,{hasImage:!!u.image_url,dimensions:f}),I}).sort((u,f)=>new Date(f.created_at).getTime()-new Date(u.created_at).getTime()).slice(0,5);return console.log("[MainCampusNews] Filtered news count:",i.length),i},[s,m]),y=r.useCallback(()=>{v.current&&clearInterval(v.current),v.current=setInterval(()=>{o(1),t(i=>(i+1)%c.length)},3300)},[c.length]);r.useEffect(()=>(c.length>0&&y(),()=>{v.current&&clearInterval(v.current)}),[c.length,y]);const C=i=>{p(null),N(i.targetTouches[0].clientX),y()},T=i=>{const u=i.targetTouches[0].clientX;if(l&&Math.abs(u-l)>j&&i.preventDefault(),p(u),l){const f=l-u;Math.abs(f)>j&&o(f>0?1:-1)}},M=()=>{if(!l||!w)return;const i=l-w,u=i>j,f=i<-j;Math.abs(i)>j&&(u&&t(I=>(I+1)%c.length),f&&t(I=>(I-1+c.length)%c.length)),y()},_=()=>{o(-1),t(i=>(i-1+c.length)%c.length),y()},L=()=>{o(1),t(i=>(i+1)%c.length),y()};if((S||g)&&(!s||s.length===0))return console.log("[MainCampusNews] Showing loading state:",{isImageLoading:S,parentLoading:g,newsLength:s==null?void 0:s.length}),e.jsxs("div",{className:"relative min-h-[425px]",children:[e.jsxs("div",{className:"relative flex items-center justify-center gap-0 px-4 md:px-12 overflow-visible",children:[e.jsx("div",{className:"w-1/4 md:w-1/5 -mr-4 md:-mr-6",children:e.jsx("div",{className:"w-full h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px] bg-gray-100 animate-pulse rounded-lg"})}),e.jsxs("div",{className:"w-2/3 md:w-3/4",children:[e.jsx("div",{className:"w-full h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px] bg-gray-100 animate-pulse rounded-lg"}),e.jsxs("div",{className:"mt-2 space-y-1.5 p-1.5",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-3/4 mx-auto"}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("div",{className:"h-2.5 bg-gray-100 animate-pulse rounded w-16"}),e.jsx("div",{className:"h-2.5 bg-gray-100 animate-pulse rounded w-2"}),e.jsx("div",{className:"h-2.5 bg-gray-100 animate-pulse rounded w-20"})]})]})]}),e.jsx("div",{className:"w-1/4 md:w-1/5 -ml-4 md:-ml-6",children:e.jsx("div",{className:"w-full h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px] bg-gray-100 animate-pulse rounded-lg"})})]}),e.jsx("div",{className:"mt-4 text-center",children:[1,2,3,4,5].map((i,u)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-200 inline-block mx-1"},u))})]});if(n)return console.log("[MainCampusNews] Showing error state:",n),e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"})]});if(c.length===0)return console.log("[MainCampusNews] Showing empty state"),e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-gray-500",children:"No news available for Main Campus"})});const x=i=>(a+i+c.length)%c.length;return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative group",onTouchStart:C,onTouchMove:T,onTouchEnd:M,style:{touchAction:"pan-y pinch-zoom"},children:[e.jsx("button",{onClick:_,className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 backdrop-blur-sm shadow-lg hidden md:block opacity-0 md:group-hover:opacity-100 transition-opacity duration-200 hover:bg-white","aria-label":"Previous slide",children:e.jsx(P,{className:"w-6 h-6 text-gray-600"})}),e.jsx("button",{onClick:L,className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 backdrop-blur-sm shadow-lg hidden md:block opacity-0 md:group-hover:opacity-100 transition-opacity duration-200 hover:bg-white","aria-label":"Next slide",children:e.jsx(F,{className:"w-6 h-6 text-gray-600"})}),e.jsx("div",{className:"relative flex items-center justify-center gap-0 px-4 md:px-12 overflow-visible",children:e.jsxs(U,{mode:"popLayout",initial:!1,children:[e.jsx(b.div,{initial:{x:100,opacity:0,scale:.8,zIndex:1},animate:{x:0,opacity:.7,scale:1.5,zIndex:1,y:40,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},exit:{x:-100,opacity:0,scale:.8,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},className:"w-1/4 md:w-1/5 -mr-4 md:-mr-6",children:e.jsx(k,{news:c[x(-1)],variant:"main",showTitle:!1})},`prev-${a}`),e.jsx(b.div,{initial:{x:h*100,opacity:0,scale:.9,zIndex:2},animate:{x:0,opacity:1,scale:1.4,zIndex:2,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},exit:{x:-h*100,opacity:0,scale:.9,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},className:"w-2/3 md:w-3/4",children:e.jsx(k,{news:c[a],variant:"main",showTitle:!0})},`current-${a}`),e.jsx(b.div,{initial:{x:-100,opacity:0,scale:.8,zIndex:1},animate:{x:0,opacity:.7,scale:1.5,zIndex:1,y:40,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},exit:{x:100,opacity:0,scale:.8,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},className:"w-1/4 md:w-1/5 -ml-4 md:-ml-6",children:e.jsx(k,{news:c[x(1)],variant:"main",showTitle:!1})},`next-${a}`)]})}),c.length>0&&e.jsx("div",{className:"mt-4 text-center",children:c.map((i,u)=>e.jsxs(b.button,{onClick:()=>{o(u>a?1:-1),t(u),y()},className:"relative inline-block mx-1",whileHover:{scale:1.2},whileTap:{scale:.9},children:[e.jsx(b.div,{className:`w-1.5 h-1.5 rounded-full ${u===a?"bg-blue-600":"bg-gray-300"}`,animate:{scale:u===a?[1,1.8,1.4]:1,opacity:u===a?1:.5},transition:{duration:.4,ease:"easeInOut",times:[0,.5,1]}}),u===a&&e.jsx(b.div,{className:"absolute inset-0 rounded-full bg-blue-600/20",layoutId:"activeDot",transition:{type:"spring",stiffness:500,damping:30}})]},u))})]})})}function O({news:s,isImageLoaded:g=!1,index:n,onImageLoaded:a,canLoad:t}){const[h,o]=r.useState(!g),[l,N]=r.useState(!1),[w,p]=r.useState(!1),[v,d]=r.useState(0),[m,S]=r.useState(!1),j=r.useRef(null),c=r.useRef(null),y=r.useRef(null),C=r.useRef(null);r.useEffect(()=>{const x=()=>{S(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))};return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]),r.useEffect(()=>{t&&!l&&(N(!0),p(!0))},[t,l]),r.useEffect(()=>(c.current=new IntersectionObserver(x=>{x.forEach(i=>{i.isIntersecting&&t&&(N(!0),p(!0))})},{root:null,rootMargin:m?"300px 0px":"1500px 0px",threshold:m?.1:0}),j.current&&c.current.observe(j.current),()=>{c.current&&c.current.disconnect()}),[t,m]),r.useEffect(()=>{if(t&&!w){const x=setTimeout(()=>{w||(N(!0),p(!0))},m?100:500);return()=>clearTimeout(x)}},[t,w,m]),r.useEffect(()=>()=>{C.current&&clearTimeout(C.current)},[]);const T=()=>{v<3?(d(x=>x+1),o(!0),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{if(y.current&&s.image_url){const x=Date.now(),i=s.image_url.includes("?")?"&":"?";y.current.src=`${s.image_url}${i}t=${x}`}},Math.min(1e3*Math.pow(2,v),5e3))):(o(!1),a(n))},M=()=>{o(!1),p(!0),a(n)},_=x=>new Date(x).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),L=()=>{s.source_url&&window.open(s.source_url,"_blank","noopener,noreferrer")};return e.jsx("div",{onClick:L,className:"block relative h-full cursor-pointer hover:opacity-90 transition-opacity",style:{touchAction:"pan-y pinch-zoom"},children:e.jsxs("div",{ref:j,className:"relative h-full overflow-hidden rounded-lg",children:[h&&e.jsx("div",{className:"h-full w-full bg-gray-100 animate-pulse"}),l&&e.jsx("img",{ref:y,src:s.image_url,alt:s.title,className:`h-[239%] w-full object-cover object-top ${h?"hidden":"block"}`,onLoad:M,onError:T,loading:m?"eager":"lazy",decoding:m?"async":"auto"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm mt-1 space-y-1 p-1 text-center",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2",children:s.title}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] text-gray-500",children:[e.jsx("span",{children:s.source_url?new URL(s.source_url).hostname.replace("www.",""):"GSU"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:_(s.published_at)})]})]})]})})}const H=async s=>{const g=new Set;return await Promise.all(s.filter(n=>n.image_url).map(async n=>{const a=n.image_url;try{const t=new Image;await new Promise((h,o)=>{t.onload=h,t.onerror=o,t.src=a}),g.add(a)}catch(t){console.warn(`Failed to preload image: ${a}`,t)}})),g};function K({news:s,loading:g,error:n}){const[a,t]=r.useState(new Set),[h,o]=r.useState(0),{data:l=new Set}=D({queryKey:["cstPreloadedImages",s.map(d=>d.id).join(",")],queryFn:()=>H(s),enabled:s.length>0,staleTime:5*60*1e3,gcTime:30*60*1e3}),N=d=>{t(m=>new Set([...m,d])),o(m=>m+1)},w=d=>d.image_url?l.has(d.image_url):!1,p=d=>Math.abs(d-h)<=3||a.has(d-1)||d<4;if(g&&(!s||s.length===0))return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((d,m)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsxs("div",{className:"w-full h-full bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"w-full h-[60%] bg-gray-100 animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-100 animate-pulse rounded w-3/4"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-16"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-5/6"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-4/6"})]})]})]})},m))});if(n)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-500",children:n})});if(!s||s.length===0)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No news available for CST"})});const v=[...s].sort((d,m)=>new Date(m.published_at).getTime()-new Date(d.published_at).getTime()).slice(0,10);return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map((d,m)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsx(O,{news:d,isImageLoaded:w(d),index:m,onImageLoaded:N,canLoad:p(m)})},d.id))})}function se(){const{data:s=[],isLoading:g,error:n}=D({queryKey:["news"],queryFn:async()=>{const{data:o,error:l}=await A();if(l)throw new Error("Failed to load news");return o},staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,retry:1}),a=s.filter(o=>{var l;return((l=o.campus)==null?void 0:l.name)==="Main Campus"}),t=s.filter(o=>{var l;return((l=o.campus)==null?void 0:l.name)==="CST"}),h=n instanceof Error?n.message:null;return e.jsxs("div",{className:"flex flex-col min-h-screen bg-white",children:[e.jsx("section",{className:"relative py-16 px-4",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight text-gray-900 mb-4",children:"What's News"}),e.jsx(b.p,{className:"text-gray-600 text-base md:text-lg max-w-2xl mx-auto leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},children:"Stay informed with the latest updates, events, and announcements from across our campuses"})]})})}),e.jsx("section",{className:"flex-1 overflow-y-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-medium text-gray-700",children:"Main Campus News"}),e.jsx(R,{to:"/news?campus=Main%20Campus",children:e.jsx(E,{className:"hover:bg-gray-50 transition-colors border-gray-300",children:e.jsx($,{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-900",children:["Show all",e.jsx(z,{className:"w-3 h-3"})]})})})})]}),e.jsx(V,{news:a,loading:g,error:h})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-medium text-gray-700",children:"College of Science and Technology"}),e.jsx(R,{to:"/news?campus=CST",children:e.jsx(E,{className:"hover:bg-gray-50 transition-colors border-gray-300",children:e.jsx($,{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-900",children:["Show all",e.jsx(z,{className:"w-3 h-3"})]})})})})]}),e.jsx(K,{news:t,loading:g,error:h})]})]})})]})}export{se as default};
//# sourceMappingURL=Home-CxF2pxqS.js.map
