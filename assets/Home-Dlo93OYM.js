import{j as e}from"./ui-L36-SHUh.js";import{u as b}from"./query-D6ti8Mjz.js";import{C as L,a as E,g as R}from"./newsService-BJvjQnH9.js";import{a as i,L as k}from"./vendor-BMJYCA8e.js";import{m as v}from"./animations-DicYFbWZ.js";import{b as M}from"./icons-CH71D4mC.js";import"./index-DlRjKpz7.js";import"./utils-DARsLm--.js";import"./index-BAYP90Ju.js";function A({news:t,isImageLoaded:m=!1,index:l,onImageLoaded:c,canLoad:r}){const[d,o]=i.useState(!m),[g,x]=i.useState(!1),[h,u]=i.useState(!1),[p,s]=i.useState(0),[a,S]=i.useState(!1),j=i.useRef(null),y=i.useRef(null),w=i.useRef(null),f=i.useRef(null);i.useEffect(()=>{const n=()=>{S(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),i.useEffect(()=>{r&&!g&&(x(!0),u(!0))},[r,g]),i.useEffect(()=>(y.current=new IntersectionObserver(n=>{n.forEach(N=>{N.isIntersecting&&r&&(x(!0),u(!0))})},{root:null,rootMargin:a?"300px 0px":"1500px 0px",threshold:a?.1:0}),j.current&&y.current.observe(j.current),()=>{y.current&&y.current.disconnect()}),[r,a]),i.useEffect(()=>{if(r&&!h){const n=setTimeout(()=>{h||(x(!0),u(!0))},a?100:500);return()=>clearTimeout(n)}},[r,h,a]),i.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const T=()=>{p<3?(s(n=>n+1),o(!0),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{if(w.current&&t.image_url){const n=Date.now(),N=t.image_url.includes("?")?"&":"?";w.current.src=`${t.image_url}${N}t=${n}`}},Math.min(1e3*Math.pow(2,p),5e3))):(o(!1),c(l))},I=()=>{o(!1),u(!0),c(l)},_=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),C=()=>{t.source_url&&window.open(t.source_url,"_blank","noopener,noreferrer")};return e.jsx("div",{onClick:C,className:"block relative h-full cursor-pointer hover:opacity-90 transition-opacity",style:{touchAction:"pan-y pinch-zoom"},children:e.jsxs("div",{ref:j,className:"relative h-full overflow-hidden rounded-lg",children:[d&&e.jsx("div",{className:"h-full w-full bg-gray-100 animate-pulse"}),g&&e.jsx("img",{ref:w,src:t.image_url,alt:t.title,className:`h-[239%] w-full object-cover object-top ${d?"hidden":"block"}`,onLoad:I,onError:T,loading:a?"eager":"lazy",decoding:a?"async":"auto"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm mt-1 space-y-1 p-1 text-center",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2",children:t.title}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] text-gray-500",children:[e.jsx("span",{children:t.source_url?new URL(t.source_url).hostname.replace("www.",""):"GSU"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:_(t.published_at)})]})]})]})})}const D=async t=>{const m=new Set;return await Promise.all(t.filter(l=>l.image_url).map(async l=>{const c=l.image_url;try{const r=new Image;await new Promise((d,o)=>{r.onload=d,r.onerror=o,r.src=c}),m.add(c)}catch(r){console.warn(`Failed to preload image: ${c}`,r)}})),m};function P({news:t,loading:m,error:l}){const[c,r]=i.useState(new Set),[d,o]=i.useState(0),{data:g=new Set}=b({queryKey:["cstPreloadedImages",t.map(s=>s.id).join(",")],queryFn:()=>D(t),enabled:t.length>0,staleTime:5*60*1e3,gcTime:30*60*1e3}),x=s=>{r(a=>new Set([...a,s])),o(a=>a+1)},h=s=>s.image_url?g.has(s.image_url):!1,u=s=>Math.abs(s-d)<=3||c.has(s-1)||s<4;if(m&&(!t||t.length===0))return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((s,a)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsxs("div",{className:"w-full h-full bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"w-full h-[60%] bg-gray-100 animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-100 animate-pulse rounded w-3/4"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-16"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-5/6"}),e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-4/6"})]})]})]})},a))});if(l)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-500",children:l})});if(!t||t.length===0)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No news available for CST"})});const p=[...t].sort((s,a)=>new Date(a.published_at).getTime()-new Date(s.published_at).getTime()).slice(0,10);return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map((s,a)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsx(A,{news:s,isImageLoaded:h(s),index:a,onImageLoaded:x,canLoad:u(a)})},s.id))})}function G(){const{data:t=[],isLoading:m,error:l}=b({queryKey:["news"],queryFn:async()=>{const{data:d,error:o}=await R();if(o)throw new Error("Failed to load news");return d},staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,retry:1}),c=t.filter(d=>{var o;return((o=d.campus)==null?void 0:o.name)==="CST"}),r=l instanceof Error?l.message:null;return e.jsxs("div",{className:"flex flex-col min-h-screen bg-white",children:[e.jsx("section",{className:"relative py-16 px-4",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight text-gray-900 mb-4",children:"What's News"}),e.jsx(v.p,{className:"text-gray-600 text-base md:text-lg max-w-2xl mx-auto leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},children:"Stay informed with the latest updates, events, and announcements from across our campuses"})]})})}),e.jsx("section",{className:"flex-1 overflow-y-auto px-4 py-8",children:e.jsx("div",{className:"max-w-6xl mx-auto space-y-12",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-medium text-gray-700",children:"College of Science and Technology"}),e.jsx(k,{to:"/news?campus=CST",children:e.jsx(L,{className:"hover:bg-gray-50 transition-colors border-gray-300",children:e.jsx(E,{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-900",children:["Show all",e.jsx(M,{className:"w-3 h-3"})]})})})})]}),e.jsx(P,{news:c,loading:m,error:r})]})})})]})}export{G as default};
//# sourceMappingURL=Home-Dlo93OYM.js.map
