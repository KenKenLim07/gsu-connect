import{a as z,j as e,A as U,m as L}from"./index-CDG8c-fi.js";import{b as s,L as E}from"./vendor-6bjjoVAz.js";import{g as V}from"./newsService-DPReNVld.js";import"./utils-DyrdIqhm.js";import"./index-CH2Xlt2V.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],R=z("arrow-right",G);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Y=z("chevron-left",F);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],B=z("chevron-right",q);function D({news:t,variant:I,isImageLoaded:w=!1,showTitle:g=!0}){const[l,j]=s.useState(!w),p=()=>{j(!1)},d=()=>{switch(I){case"main":return"h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px]";case"other":return"h-[160px] sm:h-[200px] md:h-[240px] lg:h-[280px]";default:return"h-[180px]"}},b=u=>new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),m=u=>{t.source_url&&(u.preventDefault(),window.open(t.source_url,"_blank","noopener,noreferrer"))};return e.jsxs(E,{to:t.source_url?"#":`/news/${t.id}`,onClick:m,className:"block relative",children:[e.jsxs("div",{className:"relative",children:[l&&e.jsx("div",{className:`${d()} w-full bg-gray-100 animate-pulse`}),e.jsx("img",{src:t.image_url,alt:t.title,className:`${d()} w-full object-contain ${l?"hidden":"block"}`,onLoad:p})]}),g?e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm mt-1 space-y-0.5 p-1 md:p-[15px] text-center",children:[e.jsx("h3",{className:"text-[9px] sm:text-[10px] md:text-[10px] font-medium text-gray-900 line-clamp-2 px-1 w-full overflow-hidden",children:t.title}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-[6px] sm:text-[7px] md:text-[8px] text-gray-500 px-1 w-full",children:[e.jsx("span",{className:"truncate max-w-[60px] md:max-w-[70px]",children:t.source_url?new URL(t.source_url).hostname.replace("www.",""):"GSU"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:b(t.published_at)})]})]}):e.jsx("div",{className:"h-[70px] sm:h-[80px]"})]})}function H({news:t,loading:I,error:w}){const[g,l]=s.useState(0),[j,p]=s.useState(0),[d,b]=s.useState(null),[m,u]=s.useState(null),[f,S]=s.useState({}),c=s.useRef(void 0),v=50;s.useEffect(()=>{(async()=>{if(!t.length)return;const r={};t.forEach(N=>{N.image_url&&(r[N.id]={width:0,height:0,isValid:!1,isLoading:!0})}),S(r);for(const N of t)if(N.image_url)try{const x=new Image;await new Promise(($,P)=>{x.onload=$,x.onerror=P,x.src=N.image_url});const T=x.width/x.height;S($=>({...$,[N.id]:{width:x.width,height:x.height,isValid:T>=1&&T<=1.7777777777777777,isLoading:!1}}))}catch(x){console.warn(`Failed to load image for news item ${N.id}:`,x),S(T=>({...T,[N.id]:{width:0,height:0,isValid:!1,isLoading:!1}}))}})()},[t]);const n=s.useMemo(()=>t.filter(i=>{const r=f[i.id];return i.image_url&&(r==null?void 0:r.isValid)&&!r.isLoading}).sort((i,r)=>new Date(r.created_at).getTime()-new Date(i.created_at).getTime()).slice(0,5),[t,f]),y=s.useCallback(()=>{c.current&&clearInterval(c.current),c.current=setInterval(()=>{p(1),l(i=>(i+1)%n.length)},3300)},[n.length]);s.useEffect(()=>(n.length>0&&y(),()=>{c.current&&clearInterval(c.current)}),[n.length,y]);const a=i=>{u(null),b(i.targetTouches[0].clientX),y()},o=i=>{const r=i.targetTouches[0].clientX,N=i.targetTouches[0].clientY;if(d&&Math.abs(r-d)>Math.abs(N-(d?i.targetTouches[0].clientY:0))&&i.preventDefault(),u(r),d){const x=d-r;Math.abs(x)>v&&p(x>0?1:-1)}},_=()=>{if(!d||!m)return;const i=d-m,r=i>v,N=i<-50;Math.abs(i)>v&&(r&&l(x=>(x+1)%n.length),N&&l(x=>(x-1+n.length)%n.length)),y()},C=()=>{p(-1),l(i=>(i-1+n.length)%n.length),y()},M=()=>{p(1),l(i=>(i+1)%n.length),y()};if(I)return e.jsxs("div",{className:"relative min-h-[425px]",children:[e.jsxs("div",{className:"relative flex items-center justify-center gap-0 px-4 md:px-12 overflow-visible",children:[e.jsx("div",{className:"w-1/4 md:w-1/5 -mr-4 md:-mr-6",children:e.jsx("div",{className:"w-full h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px] bg-gray-100 animate-pulse rounded-lg"})}),e.jsxs("div",{className:"w-2/3 md:w-3/4",children:[e.jsx("div",{className:"w-full h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px] bg-gray-100 animate-pulse rounded-lg"}),e.jsxs("div",{className:"mt-2 space-y-1.5 p-1.5",children:[e.jsx("div",{className:"h-3 bg-gray-100 animate-pulse rounded w-3/4 mx-auto"}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("div",{className:"h-2.5 bg-gray-100 animate-pulse rounded w-16"}),e.jsx("div",{className:"h-2.5 bg-gray-100 animate-pulse rounded w-2"}),e.jsx("div",{className:"h-2.5 bg-gray-100 animate-pulse rounded w-20"})]})]})]}),e.jsx("div",{className:"w-1/4 md:w-1/5 -ml-4 md:-ml-6",children:e.jsx("div",{className:"w-full h-[180px] sm:h-[220px] md:h-[280px] lg:h-[320px] bg-gray-100 animate-pulse rounded-lg"})})]}),e.jsx("div",{className:"mt-4 text-center",children:[1,2,3,4,5].map((i,r)=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-200 inline-block mx-1"},r))})]});if(w)return e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-red-600 mb-4",children:w}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"})]});const h=t[0],k=h?f[h.id]:null;if(!k||k.isLoading)return e.jsxs("div",{className:"relative min-h-[425px]",children:[e.jsx("div",{className:"w-full h-[330px] md:h-[500px] bg-gray-100 animate-pulse rounded-lg"}),e.jsxs("div",{className:"mt-2 space-y-2 p-1.5",children:[e.jsx("div",{className:"h-4 bg-gray-100 animate-pulse rounded w-3/4 mx-auto"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"h-4 bg-gray-100 animate-pulse rounded w-20"}),e.jsx("div",{className:"h-4 bg-gray-100 animate-pulse rounded w-24"})]})]})]});if(n.length===0)return e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-gray-500",children:"No news available for Main Campus"})});const A=i=>(g+i+n.length)%n.length;return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"text-center mb-1 sm:mb-3 md:mb-9",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-900",children:"Main Campus News"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Latest updates from the Main Campus"})]}),e.jsxs("div",{className:"relative group",onTouchStart:a,onTouchMove:o,onTouchEnd:_,style:{touchAction:"pan-y pinch-zoom"},children:[e.jsx("button",{onClick:C,className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 backdrop-blur-sm shadow-lg hidden md:block opacity-0 md:group-hover:opacity-100 transition-opacity duration-200 hover:bg-white","aria-label":"Previous slide",children:e.jsx(Y,{className:"w-6 h-6 text-gray-600"})}),e.jsx("button",{onClick:M,className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 backdrop-blur-sm shadow-lg hidden md:block opacity-0 md:group-hover:opacity-100 transition-opacity duration-200 hover:bg-white","aria-label":"Next slide",children:e.jsx(B,{className:"w-6 h-6 text-gray-600"})}),e.jsx("div",{className:"relative flex items-center justify-center gap-0 px-4 md:px-12 overflow-visible",children:e.jsxs(U,{mode:"popLayout",initial:!1,children:[e.jsx(L.div,{initial:{x:100,opacity:0,scale:.8,zIndex:1},animate:{x:0,opacity:.7,scale:1.5,zIndex:1,y:40,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},exit:{x:-100,opacity:0,scale:.8,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},className:"w-1/4 md:w-1/5 -mr-4 md:-mr-6",children:e.jsx(D,{news:n[A(-1)],variant:"main",showTitle:!1})},`prev-${g}`),e.jsx(L.div,{initial:{x:j*100,opacity:0,scale:.9,zIndex:2},animate:{x:0,opacity:1,scale:1.4,zIndex:2,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},exit:{x:-j*100,opacity:0,scale:.9,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},className:"w-2/3 md:w-3/4",children:e.jsx(D,{news:n[g],variant:"main",showTitle:!0})},`current-${g}`),e.jsx(L.div,{initial:{x:-100,opacity:0,scale:.8,zIndex:1},animate:{x:0,opacity:.7,scale:1.5,zIndex:1,y:40,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},exit:{x:100,opacity:0,scale:.8,transition:{type:"spring",stiffness:200,damping:25,mass:.8,velocity:.5}},className:"w-1/4 md:w-1/5 -ml-4 md:-ml-6",children:e.jsx(D,{news:n[A(1)],variant:"main",showTitle:!1})},`next-${g}`)]})}),n.length>0&&e.jsx("div",{className:"mt-4 text-center",children:n.map((i,r)=>e.jsx("button",{onClick:()=>{p(r>g?1:-1),l(r),y()},className:`w-1.5 h-1.5 rounded-full transition-all duration-300 inline-block mx-1 ${r===g?"bg-blue-600 scale-125":"bg-gray-300 hover:bg-gray-400"}`,"aria-label":`Go to slide ${r+1}`},r))})]})]})}function W({news:t,isImageLoaded:I=!1,index:w,onImageLoaded:g,canLoad:l}){const[j,p]=s.useState(!I),[d,b]=s.useState(!1),[m,u]=s.useState(!1),[f,S]=s.useState(0),[c,v]=s.useState(!1),n=s.useRef(null),y=s.useRef(null),a=s.useRef(null);s.useEffect(()=>{const h=()=>{v(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]),s.useEffect(()=>{l&&!d&&(b(!0),u(!0))},[l,d]),s.useEffect(()=>(y.current=new IntersectionObserver(h=>{h.forEach(k=>{k.isIntersecting&&l&&(b(!0),u(!0))})},{root:null,rootMargin:c?"300px 0px":"1500px 0px",threshold:c?.1:0}),n.current&&y.current.observe(n.current),()=>{y.current&&y.current.disconnect()}),[l,c]),s.useEffect(()=>{if(l&&!m){const h=setTimeout(()=>{m||(b(!0),u(!0))},c?100:500);return()=>clearTimeout(h)}},[l,m,c]);const o=()=>{console.log(`Image load failed for index ${w}, retry count: ${f}`),f<5&&(S(h=>h+1),p(!0),setTimeout(()=>{if(a.current&&t.image_url){const h=c?`?t=${Date.now()}`:"";a.current.src=`${t.image_url}${h}`}},c?100:300))},_=()=>{console.log(`Image loaded successfully for index ${w}`),p(!1),u(!0),g(w)},C=h=>new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),M=()=>{t.source_url&&window.open(t.source_url,"_blank","noopener,noreferrer")};return e.jsx("div",{onClick:M,className:"block relative h-full cursor-pointer hover:opacity-90 transition-opacity",style:{touchAction:"pan-y pinch-zoom"},children:e.jsxs("div",{ref:n,className:"relative h-full overflow-hidden rounded-lg",children:[j&&e.jsx("div",{className:"h-full w-full bg-gray-100 animate-pulse"}),d&&e.jsx("img",{ref:a,src:t.image_url,alt:t.title,className:`h-[239%] w-full object-cover object-top ${j?"hidden":"block"}`,onLoad:_,onError:o,loading:c?"eager":"lazy",decoding:c?"async":"auto"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm mt-1 space-y-1 p-1 text-center",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-900 line-clamp-2",children:t.title}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-[10px] text-gray-500",children:[e.jsx("span",{children:t.source_url?new URL(t.source_url).hostname.replace("www.",""):"GSU"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:C(t.published_at)})]})]})]})})}function X({news:t,loading:I,error:w}){const[g,l]=s.useState(new Set),[j,p]=s.useState(new Set),[d,b]=s.useState(0),[m,u]=s.useState(!1),[f,S]=s.useState(!1);s.useEffect(()=>{const a=()=>{S(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),s.useEffect(()=>{t&&t.filter(o=>o.image_url).map(o=>o.image_url).forEach(o=>{const _=new Image;_.src=f?`${o}?t=${Date.now()}`:o,_.onload=()=>{l(C=>new Set([...C,o]))}})},[t,f]),s.useEffect(()=>{const a=setTimeout(()=>{u(!0)},f?2e3:5e3);return()=>clearTimeout(a)},[f]);const c=a=>{p(o=>new Set([...o,a])),b(o=>o+1)},v=a=>a.image_url?g.has(a.image_url):!1,n=a=>m?!0:f?Math.abs(a-d)<=4||j.has(a-1)||a<6:Math.abs(a-d)<=3||j.has(a-1)||a<4;if(I)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(w)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-500",children:w})});if(!t||t.length===0)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No news available for CST"})});const y=[...t].sort((a,o)=>new Date(o.published_at).getTime()-new Date(a.published_at).getTime()).slice(0,10);return e.jsxs("div",{className:"px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-1xl font-semibold text-gray-900",children:"CST News"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Latest updates from the College of Science and Technology"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map((a,o)=>e.jsx("div",{className:"aspect-[4/3]",children:e.jsx(W,{news:a,isImageLoaded:v(a),index:o,onImageLoaded:c,canLoad:n(o)})},a.id))})]})}function ee(){const[t,I]=s.useState([]),[w,g]=s.useState([]),[l,j]=s.useState(!0),[p,d]=s.useState(null);return s.useEffect(()=>{(async()=>{try{const{data:m,error:u}=await V();if(u)throw u;const f=m.filter(c=>{var v;return((v=c.campus)==null?void 0:v.name)==="Main Campus"}),S=m.filter(c=>{var v;return((v=c.campus)==null?void 0:v.name)==="CST"});I(f),g(S)}catch(m){d(m instanceof Error?m.message:"Failed to fetch news")}finally{j(!1)}})()},[]),e.jsxs("div",{className:"flex flex-col min-h-screen bg-white text-gray-800",children:[e.jsx("section",{className:"relative bg-gradient-to-br from-blue-50 to-white py-14 px-4",children:e.jsxs("div",{className:"max-w-5xl mx-auto text-center",children:[e.jsx(L.h1,{className:"text-4xl font-extrabold tracking-tight mb-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:"What's News"}),e.jsx(L.p,{className:"text-gray-600 text-base mb-6 max-w-xl mx-auto",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},children:"Get the latest updates, events, and announcements from all campuses — curated just for you."}),e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:e.jsxs(E,{to:"/news",className:"inline-flex items-center px-4 py-2 text-sm font-medium rounded-md bg-gray-800 text-white hover:bg-gray-700 transition-colors",children:["View All News",e.jsx(L.span,{animate:{x:[0,4,0]},transition:{duration:1.5,repeat:1/0},className:"ml-2",children:e.jsx(R,{className:"w-4 h-4"})})]})})]})}),e.jsx("section",{className:"flex-1 overflow-y-auto px-4 py-8 bg-white",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"📍 Main Campus News"}),e.jsxs(E,{to:"/news?campus=main",className:"text-sm text-gray-500 hover:text-gray-900 transition-colors flex items-center gap-1",children:["Show all",e.jsx(R,{className:"w-3.5 h-3.5"})]})]}),e.jsx(H,{news:t,loading:l,error:p})]}),e.jsx("div",{className:"h-0.5 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"🏛️ College of Science and Technology (CST)"}),e.jsx(X,{news:w,loading:l,error:p})]})]})}),e.jsx("footer",{className:"text-center py-8 bg-gray-50 mt-auto",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Want more updates? ",e.jsx(E,{to:"/news",className:"text-blue-600 hover:underline",children:"Browse all news"})]})})]})}export{ee as default};
